<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><title>Live Audio Stream</title></head>
<body>
  <h2>Live Audio Recorder</h2>
  <button id="start">Start</button>
  <button id="stop">Stop</button>

  <script>
    let mediaRecorder, socket;

    document.getElementById('start').onclick = async () => {
      console.log('‚ñ∂Ô∏è  Starting‚Ä¶');
      socket = new WebSocket(`ws://${window.location.host}`);
      socket.onopen = () => {
        console.log('üü¢ WS opened, requesting mic‚Ä¶');
        initRecorder();
      };
      socket.onerror = e => console.error('üî¥ WS error', e);
      socket.onclose = () => console.log('‚ö™ WS closed');
    };

    function initRecorder() {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
          console.log('üéôÔ∏è Mic access granted');
          mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });

          mediaRecorder.ondataavailable = e => {
            if (e.data && e.data.size > 0 && socket.readyState === WebSocket.OPEN) {
              console.log('üì§ Sending chunk', e.data.size, 'bytes');
              socket.send(e.data);
            }
          };

          mediaRecorder.onstart = () => console.log('üî¥ Recording started');
          mediaRecorder.onstop  = () => console.log('‚èπÔ∏è Recording stopped');

          mediaRecorder.start(500); // chunk every 500ms
        })
        .catch(err => console.error('‚ö†Ô∏è getUserMedia failed:', err));
    }

    document.getElementById('stop').onclick = () => {
      console.log('‚èπÔ∏è  Stopping‚Ä¶');
      mediaRecorder?.stop();
      socket?.close();
    };
  </script>
</body>
</html>
